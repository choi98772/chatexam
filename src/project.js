require=function r(s,c,a){function l(n,t){if(!c[n]){if(!s[n]){var e="function"==typeof require&&require;if(!t&&e)return e(n,!0);if(h)return h(n,!0);var o=new Error("Cannot find module '"+n+"'");throw o.code="MODULE_NOT_FOUND",o}var i=c[n]={exports:{}};s[n][0].call(i.exports,function(t){var e=s[n][1][t];return l(e||t)},i,i.exports,r,s,c,a)}return c[n].exports}for(var h="function"==typeof require&&require,t=0;t<a.length;t++)l(a[t]);return l}({CChattingItem:[function(t,e,n){"use strict";cc._RF.push(e,"8b8b4814yhDsqCDhB2qigi0","CChattingItem"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,i=o.ccclass,r=o.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.label=null,t.textCount=14,t.mBubbleType=0,t}return __extends(t,e),t.prototype.start=function(){},t.prototype.SetString=function(t,e){if(this.mBubbleType=e,t.length<this.textCount)this.label.string=t;else{for(var n="",o=0;o<t.length;){var i=this.textCount;t.length-o<i&&(i=t.length-o);var r=t.substr(o,i);0<n.length&&(n+="\n"),n+=r,o+=i}this.label.string=n}var s=this.label.node.getContentSize();this.node.setContentSize(s.width+35,s.height+35)},t.prototype.SetBubbleType=function(t){this.mBubbleType=t},t.prototype.GetBubbleType=function(){return this.mBubbleType},t.prototype.GetWidth=function(){return this.node.getContentSize().width},t.prototype.GetHeight=function(){return this.node.getContentSize().height},t.prototype.SetPos=function(t,e){this.node.setPosition(t,e)},t.prototype.GetX=function(){return this.node.getPositionX()},t.prototype.GetY=function(){return this.node.getPositionY()},__decorate([r(cc.Label)],t.prototype,"label",void 0),__decorate([r],t.prototype,"textCount",void 0),t=__decorate([i],t)}(cc.Component);n.default=s,cc._RF.pop()},{}],CChattingMain:[function(t,e,n){"use strict";cc._RF.push(e,"b51af0SCCdBk7evc4XUxs9A","CChattingMain"),Object.defineProperty(n,"__esModule",{value:!0});var u=t("./CChattingItem"),o=t("./CTimeUtil"),r=t("./CWebSocket"),s=t("./webtoolkit.base64"),i=cc._decorator,c=i.ccclass,a=i.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mContent=null,t.mBubble1=null,t.mBubble2=null,t.mEditBox=null,t.mCurrentHeight=0,t.mTimeInfo=null,t.mWebsocket=null,t.mMyName=null,t.mUserId=-1,t}return __extends(t,e),(i=t).GetInstance=function(){return this.mInstance},t.prototype.start=function(){(i.mInstance=this).mTimeInfo=new o.default,this.mTimeInfo.Catch(),this.mWebsocket=new r.default,this.mWebsocket.Init("ws://test.wizingame.com:33777",this.OnConnected,this.OnMsgArrived,this.OnConnectionClosed),this.mMyName="Guest"+Math.floor(1e6*Math.random()),console.log("user name : "+this.mMyName)},t.prototype.update=function(t){},t.prototype.AddBubble=function(t,e){var n=null;switch(t){case 0:n=this.mBubble1;break;case 1:n=this.mBubble2}if(null!=n){var o=cc.instantiate(n);if(null!=o){var i=o.getComponent(u.default);if(null==i)return console.log("Chatting item component not found."),void o.destroy();this.mContent.addChild(o),i.SetString(e,t);var r,s=i.GetWidth(),c=i.GetHeight(),a=this.mContent.getContentSize(),l=this.mCurrentHeight+5+.5*c;this.mCurrentHeight=l+.5*c+5;var h=-.5*a.width,d=.5*a.width;switch(a.height=this.mCurrentHeight,this.mContent.setContentSize(a),505<this.mCurrentHeight&&this.mContent.setPositionY(this.mCurrentHeight-505+253),t){case 0:r=h+.5*s+20;break;case 1:r=d-.5*s-20}i.SetPos(r,-l),console.log("item added : "+r+", "+l+", maxheight = "+this.mCurrentHeight+"cs : "+a.width)}else console.log("instantiate failed.")}else console.log("base object not found")},t.prototype.OnMessageEntered=function(){null!=this.mEditBox.string&&0<this.mEditBox.string.length&&(this.AddBubble(1,this.mEditBox.string),this.SendChattingMsg(this.mEditBox.string),this.mEditBox.string="")},t.prototype.OnClickConnect=function(){this.mWebsocket.IsConnected()?this.AddBubble(1,"이미 접속 중입니다."):this.mWebsocket.Connect()},t.prototype.SendChattingMsg=function(t){if(this.mWebsocket.IsConnected())if(-1!=this.mUserId){var e={id:1,userid:this.mUserId,name:s.encode(this.mMyName),msg:s.encode(t)},n=JSON.stringify(e);this.mWebsocket.SendMsg(n),console.log(n)}else this.AddBubble(1,"아직 메시지를 보낼 수 없습니다.");else this.AddBubble(1,"서버에 접속되지 않았습니다.")},t.prototype.RequestUserId=function(){if(this.mWebsocket.IsConnected()){this.mWebsocket.SendMsg(JSON.stringify({id:0}))}},t.prototype.OnConnected=function(){i.GetInstance().AddBubble(1,"서버에 접속되었습니다."),i.GetInstance().RequestUserId()},t.prototype.SetUserId=function(t){this.mUserId=t,this.mMyName="Guest"+t},t.prototype.OnMsgArrived=function(t){try{var e=JSON.parse(t);switch(e.id){case 0:i.GetInstance().SetUserId(parseInt(e.userid)),console.log("recv my id : "+i.GetInstance().mUserId);break;case 1:if(parseInt(e.userid)==i.GetInstance().mUserId)return;console.log("sender id : "+e.userid),console.log("my id : "+i.GetInstance().mUserId);try{var n=s.decode(e.name);t=s.decode(e.msg);console.log("name : "+n),console.log("msg : "+t);var o=n+" : "+t;i.GetInstance().AddBubble(0,o)}catch(t){console.log(t.toString())}}}catch(t){}},t.prototype.OnConnectionClosed=function(){i.GetInstance().AddBubble(1,"서버접속이 해제되었습니다.")},t.mInstance=null,__decorate([a(cc.Node)],t.prototype,"mContent",void 0),__decorate([a(cc.Prefab)],t.prototype,"mBubble1",void 0),__decorate([a(cc.Prefab)],t.prototype,"mBubble2",void 0),__decorate([a(cc.EditBox)],t.prototype,"mEditBox",void 0),t=i=__decorate([c],t);var i}(cc.Component);n.default=l,cc._RF.pop()},{"./CChattingItem":"CChattingItem","./CTimeUtil":"CTimeUtil","./CWebSocket":"CWebSocket","./webtoolkit.base64":"webtoolkit.base64"}],CTimeUtil:[function(t,e,n){"use strict";cc._RF.push(e,"cd559ymCONPmJO+wT0OKGW+","CTimeUtil"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,i=o.ccclass,r=(o.property,function(){function t(){this.mOldTime=0}return t.prototype.Catch=function(){this.mOldTime=Date.now()},t.prototype.GetPassedTime=function(){return.001*(Date.now()-this.mOldTime)},t=__decorate([i],t)}());n.default=r,cc._RF.pop()},{}],CWebSocket:[function(t,e,n){"use strict";cc._RF.push(e,"a9aa6Uolz1NrpCingMGeMw6","CWebSocket"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,i=o.ccclass,r=(o.property,function(){function t(){this.mIsConnected=!1,this.mUrl=null,this.mOpenCallback=null,this.mMessageCallback=null,this.mCloseCallback=null,this.mWebSocket=null}return t.prototype.Init=function(t,e,n,o){this.mUrl=t,this.mOpenCallback=e,this.mMessageCallback=n,this.mCloseCallback=o},t.prototype.IsConnected=function(){return this.mIsConnected},t.prototype.GetWebSocket=function(){return this.mWebSocket},t.prototype.Connect=function(){this.mWebSocket=new WebSocket(this.mUrl);var e=this;this.mWebSocket.onopen=function(){e.OnWebSocketOpened()},this.mWebSocket.onmessage=function(t){e.OnMessageArrive(t)},this.mWebSocket.onclose=function(t){e.OnWebSocketClosed(t)}},t.prototype.Close=function(){null!=this.mWebSocket&&this.mWebSocket.close(),this.mIsConnected=!1},t.prototype.OnWebSocketOpened=function(){this.mIsConnected=!0,null!=this.mOpenCallback&&this.mOpenCallback()},t.prototype.OnMessageArrive=function(t){null!=this.mMessageCallback&&this.mMessageCallback(t.data)},t.prototype.OnWebSocketClosed=function(t){this.mIsConnected=!1,(this.mWebSocket=null)!=this.mCloseCallback&&this.mCloseCallback()},t.prototype.SendMsg=function(t){if(!this.mIsConnected)return!1;this.mWebSocket.send(t)},t=__decorate([i],t)}());n.default=r,cc._RF.pop()},{}],"webtoolkit.base64":[function(t,e,n){"use strict";cc._RF.push(e,"414dda4WCdHQbX3xGhnMIeN","webtoolkit.base64");var h={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var e,n,o,i,r,s,c,a="",l=0;for(t=h._utf8_encode(t);l<t.length;)i=(e=t.charCodeAt(l++))>>2,r=(3&e)<<4|(n=t.charCodeAt(l++))>>4,s=(15&n)<<2|(o=t.charCodeAt(l++))>>6,c=63&o,isNaN(n)?s=c=64:isNaN(o)&&(c=64),a=a+this._keyStr.charAt(i)+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(c);return a},decode:function(t){var e,n,o,i,r,s,c="",a=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");a<t.length;)e=this._keyStr.indexOf(t.charAt(a++))<<2|(i=this._keyStr.indexOf(t.charAt(a++)))>>4,n=(15&i)<<4|(r=this._keyStr.indexOf(t.charAt(a++)))>>2,o=(3&r)<<6|(s=this._keyStr.indexOf(t.charAt(a++))),c+=String.fromCharCode(e),64!=r&&(c+=String.fromCharCode(n)),64!=s&&(c+=String.fromCharCode(o));return c=h._utf8_decode(c)},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",n=0;n<t.length;n++){var o=t.charCodeAt(n);o<128?e+=String.fromCharCode(o):(127<o&&o<2048?e+=String.fromCharCode(o>>6|192):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128)),e+=String.fromCharCode(63&o|128))}return e},_utf8_decode:function(t){for(var e,n="",o=0,i=0,r=0;o<t.length;)(i=t.charCodeAt(o))<128?(n+=String.fromCharCode(i),o++):191<i&&i<224?(r=t.charCodeAt(o+1),n+=String.fromCharCode((31&i)<<6|63&r),o+=2):(r=t.charCodeAt(o+1),e=t.charCodeAt(o+2),n+=String.fromCharCode((15&i)<<12|(63&r)<<6|63&e),o+=3);return n}};e.exports=h,cc._RF.pop()},{}]},{},["CChattingItem","CChattingMain","CTimeUtil","CWebSocket","webtoolkit.base64"]);